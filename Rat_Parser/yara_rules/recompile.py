from argparse import ArgumentParser
from pathlib import Path
from yara import compile

DEFAULT_INPUT_PATH = str(Path(__file__).parent / "rules.yar")
DEFAULT_OUTPUT_PATH = str(Path(__file__).parent / "rules.yarc")


def recompile(input_path=DEFAULT_INPUT_PATH, output_path=DEFAULT_OUTPUT_PATH):
    compiled_rule = compile(input_path)
    compiled_rule.save(output_path)


if __name__ == "__main__":
    ap = ArgumentParser()
    ap.add_argument(
        "-i", "--input", default=DEFAULT_INPUT_PATH, help="Regra yara"
    )
    ap.add_argument(
        "-o", "--output", default=DEFAULT_OUTPUT_PATH, help="Compiled rule output path"
    )
    args = ap.parse_args()
    recompile(args.input, args.output)
